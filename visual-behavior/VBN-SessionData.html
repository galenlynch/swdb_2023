

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Visual Behavior Neuropixels Session &#8212; SWDB 2023 DataBook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'visual-behavior/VBN-SessionData';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visual Behavior Neuropixels Quickstart" href="VBN-Tutorial-Aligning_Neural_Data_to_Stimuli.html" />
    <link rel="prev" title="Visual Behavior Neuropixels Dataset" href="VBN-Dataset.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Summer Workshop on the Dynamic Brain Databook
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../background/background.html">Background</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../background/Mouse-visual-system.html">Mouse visual system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../background/transgenic-tools.html">Transgenic tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../background/Two-photon-calcium-imaging.html">Two photon calcium imaging</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../background/Neuropixels-electrophysiology.html">Neuropixels electrophysiology</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../background/NP-Processing_Pipeline.html">Processing Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../background/Ophys-ephys-comparison.html">Ophys ephys comparison</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../visual-coding-2p/vc2p-background.html">Visual Coding 2-photon</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-dataset.html">Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-session-data.html">Getting data from a session</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-stimuli.html">Visual stimuli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-evoked-response.html">Exercise: Evoked response</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-cross-session-data.html">Cross session data</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../visual-coding-np/vcnp.html">Visual Coding — Neuropixels</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-quickstart.html">Quick start guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-data-access.html">Accessing Neuropixels Visual Coding Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-quality-metrics.html">Unit Quality Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-units.html">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-receptive-fields.html">Receptive fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-lfp.html">Local field potential (LFP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-optotagging.html">Optotagging Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-session.html">Extracellular Electrophysiology Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-links.html">Other resources</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cell-type-lookup-table/ctlut-background.html">Cell Type Look-up Table</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../cell-type-lookup-table/ctlut-session-data.html">Session data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cell-type-lookup-table/ctlut-optotagging.html">Optotagging</a></li>





<li class="toctree-l2"><a class="reference internal" href="../cell-type-lookup-table/ctlut-accessing-data.html">Accessing cell type lookup table data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cell-type-lookup-table/ctlut-identifying-tagged-units.html">Identifying tagged neurons</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="vb-background.html">Visual Behavior</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="VB-Behavior.html">Visual Behavior Task</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="VB-BehaviorSessionData.html">Tutorial Accessing Behavior Session Data</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="VB-Ophys.html">Visual Behavior Ophys</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="VBO-Dataset.html">Visual Behavior Ophys Dataset</a></li>




<li class="toctree-l3"><a class="reference internal" href="VBO-ExperimentData.html">Ophys Experiment Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBO-Tutorial-Compare_trial_types.html">Tutorial Comparing Trial Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBO-Tutorial-Downloading_data_and_navigating_the_manifest.html">Tutorial Downloading Data</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="VB-Neuropixels.html">Visual Behavior Neuropixels</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="VBN-Dataset.html">Visual Behavior Neuropixels Dataset</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Visual Behavior Neuropixels Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBN-Tutorial-Aligning_Neural_Data_to_Stimuli.html">Tutorial Aligning Neural Data to Stimuli</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBN-Tutorial-Aligning_Behavior_Data_to_Task_Events.html">Tutorial Aligning Behavioral Data to Task Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBN-Tutorial-Analyzing_LFP_Data.html">Tutorial Analyzing LFP data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../microns-em/em-background.html">EM Connectomics</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-structural-data.html">Dataset Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/proofreading.html">Proofreading and Data Quality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-neuroglancer.html">Neuroglancer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-dash-apps.html">Dash Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-caveclient-setup.html">Setting up CAVEclient</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-querying-tables.html">Programmatic Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/key-tables.html">Annotation Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-volume-data.html">Imagery and Segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-skeletons.html">Skeletons</a></li>








<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-meshes.html">Meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-functional_data.html">MICrONS Functional Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-ultrastructure.html">Ultrastructure Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fvisual-behavior/VBN-SessionData.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/visual-behavior/VBN-SessionData.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Visual Behavior Neuropixels Session</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metadata">Metadata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ephys-data">Ephys Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#behavior-data">Behavior Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#behavior-trials-table">Behavior Trials Table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stimulus-presentations-table">Stimulus Presentations Table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optotagging-table">Optotagging Table</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="visual-behavior-neuropixels-session">
<h1>Visual Behavior Neuropixels Session<a class="headerlink" href="#visual-behavior-neuropixels-session" title="Permalink to this heading">#</a></h1>
<p>Once you’ve selected a session of interest, the corresponding nwb file can be conveniently accessed through the AllenSDK. <code>VisualBehaviorNeuropixelsProjectCache</code> class.</p>
<p>Below, we will walk through what’s contained in each of these session nwb files. For more examples demonstrating how to analyze these data, please refer to the tutorials <a class="reference external" href="https://allensdk.readthedocs.io/en/latest/visual_behavior_neuropixels.html">here</a></p>
<p>We begin by importing the <code>VisualBehaviorNeuropixelsProjectCache</code>  class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">allensdk.brain_observatory.behavior.behavior_project_cache.</span>\
    <span class="n">behavior_neuropixels_project_cache</span> \
    <span class="kn">import</span> <span class="nn">VisualBehaviorNeuropixelsProjectCache</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/envs/allensdk/lib/python3.8/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
</div>
</div>
<p>Now we can specify our cache directory and set up the cache.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this path should point to the location of the dataset on your platform</span>
<span class="n">cache_dir</span> <span class="o">=</span> <span class="s1">&#39;/root/capsule/data/visual-behavior-neuropixels/&#39;</span>

<span class="n">cache</span> <span class="o">=</span> <span class="n">VisualBehaviorNeuropixelsProjectCache</span><span class="o">.</span><span class="n">from_local_cache</span><span class="p">(</span>
            <span class="n">cache_dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">use_static_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># this path should point to the location of the dataset on your platform</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">cache_dir</span> <span class="o">=</span> <span class="s1">&#39;/root/capsule/data/visual-behavior-neuropixels/&#39;</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">VisualBehaviorNeuropixelsProjectCache</span><span class="o">.</span><span class="n">from_local_cache</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>             <span class="n">cache_dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">use_static_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File /opt/envs/allensdk/lib/python3.8/site-packages/allensdk/brain_observatory/behavior/behavior_project_cache/project_cache_base.py:110,</span> in <span class="ni">ProjectCacheBase.from_local_cache</span><span class="nt">(cls, cache_dir, use_static_cache)</span>
<span class="g g-Whitespace">     </span><span class="mi">87</span> <span class="nd">@classmethod</span>
<span class="g g-Whitespace">     </span><span class="mi">88</span> <span class="k">def</span> <span class="nf">from_local_cache</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>     <span class="bp">cls</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>     <span class="n">cache_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">91</span>     <span class="n">use_static_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ProjectCacheBase&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;instantiates this object with a local cache.</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">95</span><span class="sd">     Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">108</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">109</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">110</span>     <span class="n">fetch_api</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cloud_api_class</span><span class="p">()</span><span class="o">.</span><span class="n">from_local_cache</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">111</span>         <span class="n">cache_dir</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span>         <span class="n">project_name</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">PROJECT_NAME</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">113</span>         <span class="n">ui_class_name</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span>         <span class="n">use_static_cache</span><span class="o">=</span><span class="n">use_static_cache</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span>     <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fetch_api</span><span class="o">=</span><span class="n">fetch_api</span><span class="p">)</span>

<span class="nn">File /opt/envs/allensdk/lib/python3.8/site-packages/allensdk/brain_observatory/behavior/behavior_project_cache/project_apis/data_io/project_cloud_api_base.py:143,</span> in <span class="ni">ProjectCloudApiBase.from_local_cache</span><span class="nt">(cls, cache_dir, project_name, ui_class_name, use_static_cache)</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;instantiates this object with a local cache.</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">124</span><span class="sd"> Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">141</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span> <span class="k">if</span> <span class="n">use_static_cache</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">143</span>     <span class="n">cache</span> <span class="o">=</span> <span class="n">StaticLocalCache</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span>         <span class="n">cache_dir</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span>         <span class="n">project_name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span>         <span class="n">ui_class_name</span><span class="o">=</span><span class="n">ui_class_name</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span>     <span class="n">cache</span> <span class="o">=</span> <span class="n">LocalCache</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span>         <span class="n">cache_dir</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span>         <span class="n">project_name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>         <span class="n">ui_class_name</span><span class="o">=</span><span class="n">ui_class_name</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span>     <span class="p">)</span>

<span class="nn">File /opt/envs/allensdk/lib/python3.8/site-packages/allensdk/api/cloud_cache/cloud_cache.py:1245,</span> in <span class="ni">StaticLocalCache.__init__</span><span class="nt">(self, cache_dir, project_name, ui_class_name)</span>
<span class="g g-Whitespace">   </span><span class="mi">1244</span> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">ui_class_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1245</span>     <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cache_dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1246</span>                      <span class="n">ui_class_name</span><span class="o">=</span><span class="n">ui_class_name</span><span class="p">)</span>

<span class="nn">File /opt/envs/allensdk/lib/python3.8/site-packages/allensdk/api/cloud_cache/cloud_cache.py:78,</span> in <span class="ni">BasicLocalCache.__init__</span><span class="nt">(self, cache_dir, project_name, ui_class_name)</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span> <span class="o">=</span> <span class="n">cache_dir</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span> <span class="o">=</span> <span class="n">project_name</span>
<span class="ne">---&gt; </span><span class="mi">78</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manifest_file_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_all_manifests</span><span class="p">()</span>

<span class="nn">File /opt/envs/allensdk/lib/python3.8/site-packages/allensdk/api/cloud_cache/cloud_cache.py:1258,</span> in <span class="ni">StaticLocalCache._list_all_manifests</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1254</span> <span class="n">manifest_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1255</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;manifests&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1256</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1257</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1258</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1259</span>         <span class="sa">f</span><span class="s2">&quot;Expected the provided cache_dir (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1260</span>         <span class="s2">&quot;to have the following subfolders but it did not: &quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1261</span>         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">/manifests&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1262</span>     <span class="p">)</span>
<span class="nn">   1264 output = [x for x</span> in <span class="ni">os.listdir</span><span class="nt">(manifest_dir)</span>
<span class="g g-Whitespace">   </span><span class="mi">1265</span>           <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="s2">&quot;.*_manifest_v.*.json&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)]</span>
<span class="g g-Whitespace">   </span><span class="mi">1267</span> <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_find_latest_file</span><span class="p">(</span><span class="n">output</span><span class="p">)]</span>

<span class="ne">RuntimeError</span>: Expected the provided cache_dir (/root/capsule/data/visual-behavior-neuropixels/)to have the following subfolders but it did not: visual-behavior-neuropixels/manifests
</pre></div>
</div>
</div>
</div>
<p>We can use the <code>VisualBehaviorNeuropixelsProjectCache</code> to grab the data for one example session:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session_id</span> <span class="o">=</span> <span class="mi">1053941483</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_ecephys_session</span><span class="p">(</span>
            <span class="n">ecephys_session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can list the attributes and methods associated with this session object as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">list_data_attributes_and_methods</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s see how theses are defined. First we’ll group them into a few classes:
<b>metadata</b>: attributes that contain useful info about each session
<b>data</b>:     attributes and methods for accessing primary data for this session, including spike data, lfp, licks, running and eye tracking
<b>tables</b>:   attributes and methods for accessing the tables storing stimulus info, behavior trial info</p>
<section id="metadata">
<h2>Metadata<a class="headerlink" href="#metadata" title="Permalink to this heading">#</a></h2>
<p>The following attributes contain metadata about each session. Most of the necessary metadata can be found in the <code class="docutils literal notranslate"><span class="pre">session.metadata</span></code> attribute, including the rig on which this experiment was run, the genotype, age and sex of the mouse and the name of the behavioral script:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
</div>
<p>The following attributes also contain useful info:</p>
<p><code class="docutils literal notranslate"><span class="pre">behavior_session_id</span></code>:  Unique ID for the behavior session associated with this experiment.
<code class="docutils literal notranslate"><span class="pre">task_parameters</span></code>:      Dictionary of parameters for this behavioral session as follows:</p>
<dl class="simple myst">
<dt>auto_reward_volume</dt><dd><p>Volume of autorewards delivered at beginning of session in ml.</p>
</dd>
<dt>blank_duration_sec</dt><dd><p>Seconds of gray screen at beginning and end of behavior session</p>
</dd>
<dt>n_stimulus_frames</dt><dd><p>Number of stimulus frames rendered during this experiment</p>
</dd>
<dt>omitted_flash_fraction</dt><dd><p>Probability that eligible flashes were omitted</p>
</dd>
<dt>response_window_sec</dt><dd><p>The period following an image change, in seconds, during which a mouse response influences trial outcome. The first value represents response window start. The second value represents response window end. The values represent time before display lag is accounted for and applied.</p>
</dd>
<dt>reward_volume</dt><dd><p>volume of individual water reward in ml.</p>
</dd>
<dt>session_type</dt><dd><p>visual stimulus type displayed during behavior session</p>
</dd>
<dt>stimulus</dt><dd><p>stimulus class shown for each image flash</p>
</dd>
<dt>stimulus_distribution</dt><dd><p>Probablity distribution used for drawing change times. Either ‘exponential’ or ‘geometric’</p>
</dd>
<dt>stimulus_duration_sec</dt><dd><p>duration in seconds of each stimulus image presentation (or ‘flash’)</p>
</dd>
<dt>task</dt><dd><p>type of visual stimulus task; ‘change detection’ for this dataset</p>
</dd>
</dl>
</section>
<section id="ephys-data">
<h2>Ephys Data<a class="headerlink" href="#ephys-data" title="Permalink to this heading">#</a></h2>
<p>The primary ephys data can be accessed through the following attributes and methods. To see examples for how to align neural activity to task and stimulus events, check out the tutorials <a class="reference external" href="https://allensdk.readthedocs.io/en/latest/visual_behavior_neuropixels.html">here</a>.</p>
<p>Let’s start by choosing an example unit and extracting its spike times and mean waveform. We can use the <code class="docutils literal notranslate"><span class="pre">get_units</span></code> method to identify a unit of interest. To filter units by their brain structure, it is useful to first merge the units table with the channels table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">units</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_units</span><span class="p">()</span> <span class="c1">#get units table</span>
<span class="n">channels</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_channels</span><span class="p">()</span> <span class="c1">#get channels table</span>
<span class="n">units_channels</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;peak_channel_id&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#merge the two tables</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can pull out a few of the units recorded in VISp:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">units_channels</span><span class="p">[</span><span class="n">units_channels</span><span class="p">[</span><span class="s1">&#39;structure_acronym&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;VISp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take the first unit as our example: 1061854534. Three dictionaries will allow us to access data for this unit:</p>
<p><code class="docutils literal notranslate"><span class="pre">spike_times</span></code>: dictionary storing spike times for each unit
<code class="docutils literal notranslate"><span class="pre">spike_amplitudes</span></code>: dictionary storing the spike amplitudes for each units in volts
<code class="docutils literal notranslate"><span class="pre">mean_waveforms</span></code>: dictionary storing the mean waveform for each unit as a (channel: 384, sample_number: 82) array</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit_spiketimes</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">spike_times</span><span class="p">[</span><span class="mi">1061854534</span><span class="p">]</span>
<span class="n">unit_spike_amplitudes</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">spike_amplitudes</span><span class="p">[</span><span class="mi">1061854534</span><span class="p">]</span>
<span class="n">unit_waveform</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">mean_waveforms</span><span class="p">[</span><span class="mi">1061854534</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>LFP data can be accessed through the following methods. Keep in mind that LFP data is stored in separate NWB files. Calling these methods will download additional data. For more info about how to access and analyze the LFP data, check out <a class="reference external" href="https://allensdk.readthedocs.io/en/latest/_static/examples/nb/visual_behavior_neuropixels_LFP_analysis.html">this tutorial</a>.</p>
<p>The LFP data is stored as an <a class="reference external" href="http://xarray.pydata.org/en/stable/">xarray.DataArray</a> object, with coordinates of time and channel. The xarray library simplifies the process of working with N-dimensional data arrays, by keeping track of the meaning of each axis. If this is your first time encountering xarrays, we strongly recommend reading through the documentation before going further. Getting used to xarrays can be frustrating, especially when they don’t behave like numpy arrays. But they are designed to prevent common mistakes when analyzing multidimensional arrays, so they are well worth learning more about. Plus, the syntax is modeled on that of the pandas library, so if you’re familiar with that you already have a head start.</p>
<p>The LFP for each probe insertion is stored in a separate NWB file. To see what probes were inserted for this experiment, we can look at the <code class="docutils literal notranslate"><span class="pre">session.probes</span></code> table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">probes</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can grab the LFP data for one of these probes (let’s take 1054059291). The following line of code will download a lfp NWB file if it’s not already part of your cache:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">probe_lfp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_lfp</span><span class="p">(</span><span class="mi">1054059291</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Since this LFP has been spatially downsampled, a high resolution CSD has been pre-computed and stored as an xarray.DataArray. You can access this CSD as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">probe_csd</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_current_source_density</span><span class="p">(</span><span class="mi">1054059291</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="behavior-data">
<h2>Behavior Data<a class="headerlink" href="#behavior-data" title="Permalink to this heading">#</a></h2>
<p>Each session NWB also contains running, licking and eye tracking data. These data are all stored as pandas dataframes in the session object. For more details about how to align behavioral data to task events, check out <a class="reference external" href="https://allensdk.readthedocs.io/en/latest/_static/examples/nb/aligning_behavioral_data_to_task_events_with_the_stimulus_and_trials_tables.html">this tutorial</a></p>
<p><code class="docutils literal notranslate"><span class="pre">session.eye_tracking</span></code>: A dataframe containing ellipse fit parameters for the eye, pupil and corneal reflection (cr). Fits are derived from tracking points from a DeepLabCut model applied to video (collected at 60hz) frames of a subject’s right eye. The corneal reflection (cr) fit can be used to estimate the axis of the camera. Taking the difference between the corneal reflection position and the pupil position can therefore disambiguate translations of the entire eye (in which case both the cr and pupil will shift together) from rotations of the eye (in which case the pupil position will move relative to the cr).</p>
<p><img alt="eye_dlc_labels" src="images/dlc_eye_label_example.png" /></p>
<dl class="simple myst">
<dt>frame (index)</dt><dd><p><em>int</em> frame of eye tracking video.</p>
</dd>
<dt>timestamps</dt><dd><p><em>float</em> experiment timestamp for frame in seconds</p>
</dd>
<dt>likely_blink</dt><dd><p><em>bool</em> True if frame has outlier ellipse fits, which is often caused by blinking / squinting of the eye.</p>
</dd>
<dt>eye_area</dt><dd><p><em>float</em> area of eye ellipse in pixels squared</p>
</dd>
<dt>eye_area_raw</dt><dd><p><em>float</em> pupil area with no outliers/likely blinks removed.</p>
</dd>
<dt>eye_center_x</dt><dd><p><em>float</em> center of eye ellipse on x axis in pixels</p>
</dd>
<dt>eye_center_y</dt><dd><p><em>float</em> center of eye ellipse on y axis in pixels</p>
</dd>
<dt>eye_height</dt><dd><p><em>float</em> eye height (minor axis of the eye ellipse) in pixels</p>
</dd>
<dt>eye_width</dt><dd><p><em>float</em> eye width (major axis of the eye ellipse) in pixels</p>
</dd>
<dt>eye_phi</dt><dd><p><em>float</em> eye rotation angle in radians</p>
</dd>
<dt>pupil_area</dt><dd><p><em>float</em> area of pupil ellipse in pixels squared</p>
</dd>
<dt>pupil_area_raw</dt><dd><p><em>float</em> pupil area with no outliers/likely blinks removed.</p>
</dd>
<dt>pupil_center_x</dt><dd><p><em>float</em> center of pupil ellipse on x axis in pixels</p>
</dd>
<dt>pupil_center_y</dt><dd><p><em>float</em> center of pupil ellipse on y axis in pixels</p>
</dd>
<dt>pupil_height</dt><dd><p><em>float</em> pupil height (minor axis of the pupil ellipse) in pixels</p>
</dd>
<dt>pupil_width</dt><dd><p><em>float</em> pupil width (major axis of the pupil ellipse) in pixels</p>
</dd>
<dt>pupil_phi</dt><dd><p><em>float</em> pupil rotation angle in radians</p>
</dd>
<dt>cr_area</dt><dd><p><em>float</em> area of corneal reflection ellipse in pixels squared</p>
</dd>
<dt>cr_area_raw</dt><dd><p><em>float</em> corneal reflection area with no outliers/likely blinks removed.</p>
</dd>
<dt>cr_center_x</dt><dd><p><em>float</em> center of corneal reflection on x axis in pixels</p>
</dd>
<dt>cr_center_y</dt><dd><p><em>float</em> center of corneal reflection on y axis in pixels</p>
</dd>
<dt>cr_height</dt><dd><p><em>float</em> corneal reflection height (minor axis of the CR ellipse) in pixels</p>
</dd>
<dt>cr_width</dt><dd><p><em>float</em> corneal reflection width (major axis of the CR ellipse) in pixels</p>
</dd>
<dt>cr_phi</dt><dd><p><em>float</em> corneal reflection rotation angle in radians</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">session.licks</span></code>: A dataframe containing lick timestamps and frames, sampled at 60Hz.</p>
<dl class="simple myst">
<dt>timestamps</dt><dd><p><em>float</em> time of a lick, in seconds</p>
</dd>
<dt>frame</dt><dd><p><em>int</em> frame of lick</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">session.running_speed</span></code>: Running speed and timestamps sampled at 60hz. A 10Hz low pass filter has been applied to the data. To get the running speed without the filter, use <code class="docutils literal notranslate"><span class="pre">raw_running_speed</span></code>.</p>
<dl class="simple myst">
<dt>speed</dt><dd><p><em>float</em> speed in cm/sec</p>
</dd>
<dt>timestamps</dt><dd><p><em>float</em> time in seconds</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">rewards</span></code>: A dataframe containing timestamps of delivered rewards in absolute sync time. Timestamps are sampled at 60 Hz.</p>
<dl class="simple myst">
<dt>timestamps</dt><dd><p><em>float</em> time in seconds</p>
</dd>
<dt>volume</dt><dd><p><em>float</em> volume of individual water reward in ml.</p>
</dd>
<dt>auto_rewarded</dt><dd><p><em>bool</em> True if free reward was delivered for that trial. Occurs during the first 5 trials of a session.</p>
</dd>
</dl>
</section>
<section id="behavior-trials-table">
<h2>Behavior Trials Table<a class="headerlink" href="#behavior-trials-table" title="Permalink to this heading">#</a></h2>
<p>Now let’s explore the behavior trials table. This table contains lots of useful information about every trial in the change detection task. For more info about how to use this table to align behavioral/neural events, you might find <a class="reference external" href="https://github.com/AllenInstitute/swdb_2022/blob/main/DynamicBrain/solutions/Visual_Behavior_Neuropixels_SWDB_2022_Tutorial_Solutions.ipynb">this tutorial</a> useful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">trials</span>
<span class="n">trials</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here, every row is one behavioral trial. The following columns contain all the information you need to interpret each trial:</p>
<dl class="simple myst">
<dt>start_time</dt><dd><p><em>float</em> Experiment time when this trial began in seconds.</p>
</dd>
<dt>end_time</dt><dd><p><em>float</em> Experiment time when this trial ended.</p>
</dd>
<dt>initial_image_name</dt><dd><p><em>float</em> Indicates which image was shown before the change (or sham change) for this trial</p>
</dd>
<dt>change_image_name</dt><dd><p><em>string</em> Indicates which image was scheduled to be the change image for this trial. Note that if the trial is aborted, a new trial will begin before this change occurs.</p>
</dd>
<dt>stimulus_change</dt><dd><p><em>bool</em> Indicates whether an image change occurred for this trial.</p>
</dd>
<dt>change_time_no_display_delay</dt><dd><p><em>float</em> Experiment time when the task-control computer commanded an image change. This change time is used to determine the response window during which a lick will trigger a reward. Note that due to display lag, this is not the time when the change image actually appears on the screen. To get this time, you need the stimulus_presentations table (more about this below).</p>
</dd>
<dt>go</dt><dd><p><em>bool</em> Indicates whether this trial was a ‘go’ trial. To qualify as a go trial, an image change must occur and the trial cannot be autorewarded.</p>
</dd>
<dt>catch</dt><dd><p><em>bool</em> Indicates whether this trial was a ‘catch’ trial. To qualify as a catch trial, a ‘sham’ change must occur during which the image identity does not change. These sham changes are drawn to match the timing distribution of real changes and can be used to calculate the false alarm rate.</p>
</dd>
<dt>lick_times</dt><dd><p><em>float array</em> A list indicating when the behavioral control software recognized a lick. Note that this is not identical to the lick times from the licks dataframe, which record when the licks were registered by the lick sensor. The licks dataframe should generally be used for analysis of the licking behavior rather than these times.</p>
</dd>
<dt>response_time</dt><dd><p><em>float</em> Indicates the time when the first lick was registered by the task control software for trials that were not aborted (go or catch). NaN for aborted trials. For a more accurate measure of response time, the licks dataframe should be used.</p>
</dd>
<dt>reward_time</dt><dd><p><em>float</em> Indicates when the reward command was triggered for hit trials. NaN for other trial types.</p>
</dd>
<dt>reward_volume</dt><dd><p><em>float</em> Indicates the volume of water dispensed as reward for this trial.</p>
</dd>
<dt>hit</dt><dd><p><em>bool</em> Indicates whether this trial was a ‘hit’ trial. To qualify as a hit, the trial must be a go trial during which the stimulus changed and the mouse licked within the reward window (150-750 ms after the change time).</p>
</dd>
<dt>false_alarm</dt><dd><p><em>bool</em> Indicates whether this trial was a ‘false alarm’ trial. To qualify as a false alarm, the trial must be a catch trial during which a sham change occurred and the mouse licked during the reward window.</p>
</dd>
<dt>miss</dt><dd><p><em>bool</em> To qualify as a miss trial, the trial must be a go trial during which the stimulus changed but the mouse did not lick within the response window.</p>
</dd>
<dt>correct_reject</dt><dd><p><em>bool</em> To qualify as a correct reject trial, the trial must be a catch trial during which a sham change occurred and the mouse withheld licking.</p>
</dd>
<dt>aborted</dt><dd><p><em>bool</em> A trial is aborted when the mouse licks before the scheduled change or sham change.</p>
</dd>
<dt>auto_rewarded</dt><dd><p><em>bool</em> During autorewarded trials, the reward is automatically triggered after the change regardless of whether the mouse licked within the response window. These always come at the beginning of the session to help engage the mouse in behavior.</p>
</dd>
<dt>change_frame</dt><dd><p><em>int</em> Indicates the stimulus frame index when the change (on go trials) or sham change (on catch trials) occurred. This column can be used to link the trials table with the stimulus presentations table, as shown below.</p>
</dd>
<dt>trial_length</dt><dd><p><em>float</em> Duration of the trial in seconds.</p>
</dd>
</dl>
</section>
<section id="stimulus-presentations-table">
<h2>Stimulus Presentations Table<a class="headerlink" href="#stimulus-presentations-table" title="Permalink to this heading">#</a></h2>
<p>This shows us the structure of this experiment (and every experiment in this dataset). There are 5 stimuli as follows:</p>
<p><strong>block 0</strong>: Change detection task. Natural images are flashed repeatedly and the mouse is rewarded for licking when the identity of the image changes. You can find more info about this task <a class="reference external" href="http://portal.brain-map.org/explore/circuits/visual-behavior-neuropixels?edit&amp;language=en">here</a>. Also see <a class="reference external" href="https://www.frontiersin.org/articles/10.3389/fnbeh.2020.00104/full">here</a> for info about our general training strategy.</p>
<p><strong>block 1</strong>: Brief gray screen</p>
<p><strong>block 2</strong>: Receptive field mapping. Gabor stimuli used for receptive field mapping. For more details on this stimulus consult <a class="reference external" href="https://allensdk.readthedocs.io/en/latest/_static/examples/nb/ecephys_receptive_fields.html">this notebook</a>.</p>
<p><strong>block 3</strong>: Longer gray screen</p>
<p><strong>block 4</strong>: Full-field flashes, shown at 80% contrast. Flashes can be black (color = -1) or white (color = 1).</p>
<p><strong>block 5</strong>: Passive replay. Frame-for-frame replay of the stimulus shown during the change detection task (block 0), but now with the lick spout retracted so the animal can no longer engage in the task.</p>
<p>Here’s a quick explanation for each of the columns in this table:</p>
<p><b>General</b></p>
<p><code class="docutils literal notranslate"><span class="pre">active</span></code>: Boolean indicating when the change detection task (with the lick spout available to the mouse) was run. This should only be TRUE for block 0.</p>
<p><code class="docutils literal notranslate"><span class="pre">stimulus_block</span></code>: Index of stimulus as described in cells above.</p>
<p><code class="docutils literal notranslate"><span class="pre">stimulus_name</span></code>: Indicates the stimulus category for this stimulus presentation.</p>
<p><code class="docutils literal notranslate"><span class="pre">contrast</span></code>: Stimulus contrast as defined <a class="reference external" href="https://www.psychopy.org/api/visual/gratingstim.html#psychopy.visual.GratingStim.contrast">here</a></p>
<p><code class="docutils literal notranslate"><span class="pre">duration</span></code>: Duration of stimulus in seconds</p>
<p><code class="docutils literal notranslate"><span class="pre">start_time</span></code>: Experiment time when stimulus started. This value is corrected for display lag and therefore indicates when the stimulus actually appeared on the screen.</p>
<p><code class="docutils literal notranslate"><span class="pre">end_time</span></code>: Experiment time when stimulus ended, also corrected for display lag.</p>
<p><code class="docutils literal notranslate"><span class="pre">start_frame</span></code>: Stimulus frame index when this stimulus started. This can be used to sync this table to the behavior trials table, for which behavioral data is collected every frame.</p>
<p><code class="docutils literal notranslate"><span class="pre">end_frame</span></code>: Stimulus frame index when this stimulus ended.</p>
<p><b>Change</b> detection task and Passive replay (blocks 0 and 5)</p>
<p><code class="docutils literal notranslate"><span class="pre">flashes_since_change</span></code>: Indicates how many flashes of the same image have occurred since the last stimulus change.</p>
<p><code class="docutils literal notranslate"><span class="pre">image_name</span></code>: Indicates which natural image was flashed for this stimulus presentation. To see how to visualize this image, check out <a class="reference external" href="https://allensdk.readthedocs.io/en/latest/_static/examples/nb/visual_behavior_neuropixels_data_access.html">this tutorial</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">is_change</span></code>: Indicates whether the image identity changed for this stimulus presentation. When both this value and ‘active’ are TRUE, the mouse was rewarded for licking within the response window.</p>
<p><code class="docutils literal notranslate"><span class="pre">omitted</span></code>: Indicates whether the image presentation was omitted for this flash. Most image flashes had a 5% probability of being omitted (producing a gray screen). Flashes immediately preceding a change or immediately following an omission could not be omitted.</p>
<p><code class="docutils literal notranslate"><span class="pre">rewarded</span></code>: Indicates whether a reward was given after this image presentation. During the passive replay block (5), this value indicates that a reward was issued for the corresponding image presentation during the active behavior block (0). No rewards were given during passive replay.</p>
<p><b>Receptive field mapping gabor stimulus (block 2)</b></p>
<p><code class="docutils literal notranslate"><span class="pre">orientation</span></code>: Orientation of gabor.</p>
<p><code class="docutils literal notranslate"><span class="pre">position_x</span></code>: Position of the gabor along azimuth. The units are in degrees relative to the center of the screen (negative values are nasal).</p>
<p><code class="docutils literal notranslate"><span class="pre">position_y</span></code>: Position of the gabor along elevation. Negative values are lower elevation.</p>
<p><code class="docutils literal notranslate"><span class="pre">spatial_frequency</span></code>: Spatial frequency of gabor in cycles per degree.</p>
<p><code class="docutils literal notranslate"><span class="pre">temporal_frequency</span></code>: Temporal frequency of gabor in Hz.</p>
<p><b>Full field flashes (block 4)</b></p>
<p><code class="docutils literal notranslate"><span class="pre">color</span></code>: Color of the full-field flash stimuli. “1” is white and “-1” is black.</p>
</section>
<section id="optotagging-table">
<h2>Optotagging Table<a class="headerlink" href="#optotagging-table" title="Permalink to this heading">#</a></h2>
<dl class="simple myst">
<dt>id <b>index</b></dt><dd><p><em>int</em> Trial index</p>
</dd>
<dt>condition</dt><dd><p><em>string</em> Description of laser waveform used for this trial</p>
</dd>
<dt>duration</dt><dd><p><em>float</em> Duration of laser stimulation for this trial</p>
</dd>
<dt>level</dt><dd><p><em>float</em> Laser command voltage for this trial (higher values indicate higher power laser stimulation)</p>
</dd>
<dt>start_time</dt><dd><p><em>float</em> Start time of laser stimulation for this trial</p>
</dd>
<dt>stimulus_name</dt><dd><p><em>string</em> Name of laser waveform used for this trial</p>
</dd>
<dt>stop_time</dt><dd><p><em>float</em> Time when laser stimulation stops for this trial</p>
</dd>
</dl>
<p>stimulus_templates
stimulus_timestamps</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "allensdk"
        },
        kernelOptions: {
            name: "allensdk",
            path: "./visual-behavior"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'allensdk'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="VBN-Dataset.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Visual Behavior Neuropixels Dataset</p>
      </div>
    </a>
    <a class="right-next"
       href="VBN-Tutorial-Aligning_Neural_Data_to_Stimuli.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Visual Behavior Neuropixels Quickstart</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metadata">Metadata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ephys-data">Ephys Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#behavior-data">Behavior Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#behavior-trials-table">Behavior Trials Table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stimulus-presentations-table">Stimulus Presentations Table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optotagging-table">Optotagging Table</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Saskia de Vries, Marina Garrett, Corbett Bennet, Galen Lynch, Anna Lakunina, Casey Schneider-Mizell
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>